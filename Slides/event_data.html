<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>News data sources</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="event_data_files/libs/clipboard/clipboard.min.js"></script>
<script src="event_data_files/libs/quarto-html/quarto.js"></script>
<script src="event_data_files/libs/quarto-html/popper.min.js"></script>
<script src="event_data_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="event_data_files/libs/quarto-html/anchor.min.js"></script>
<link href="event_data_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="event_data_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="event_data_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="event_data_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="event_data_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#some-sources-for-getting-news-coverage-of-contentious-politics" id="toc-some-sources-for-getting-news-coverage-of-contentious-politics" class="nav-link active" data-scroll-target="#some-sources-for-getting-news-coverage-of-contentious-politics"><strong>Some sources for getting news coverage of contentious politics</strong></a></li>
  <li><a href="#finding-data-about-a-movement-tactic-or-group-in-factiva" id="toc-finding-data-about-a-movement-tactic-or-group-in-factiva" class="nav-link" data-scroll-target="#finding-data-about-a-movement-tactic-or-group-in-factiva">Finding data about a movement, tactic, or group in Factiva</a>
  <ul class="collapse">
  <li><a href="#importing-factiva-articles-to-r" id="toc-importing-factiva-articles-to-r" class="nav-link" data-scroll-target="#importing-factiva-articles-to-r">Importing Factiva Articles to R</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">News data sources</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Collecting data from newspaper coverage is one common way to study contentious political behavior. Even if you’re not trying to build a protest event data set from scratch, reading news some news coverage is always a good way to get a better handle on what activists are doing, their demands, the public response, and how the press is covering them.</p>
<p>Historically this kind of research have meant picking a handful of news outlets and then painstakingly skimming every article they published in a given time frame, but most contemporary event data collection relies on searchable news databases like the ones listed below.</p>
<section id="some-sources-for-getting-news-coverage-of-contentious-politics" class="level1">
<h1><strong>Some sources for getting news coverage of contentious politics</strong></h1>
<p>These databases are all available through the <a href="https://lib.guides.umd.edu/az.php">database finder portal</a> on the UMD library website. You should be able to access these off-campus as long as you enter your UMD login information when prompted.</p>
<table class="table">
<thead>
<tr class="header">
<th>Source</th>
<th>Coverage</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="http://www.keesings.com.proxy-um.researchport.umd.edu/index_new.php">Keesing’s World News Archive</a></td>
<td>Global coverage 1931 to Present</td>
<td>Draws heavily from global wire services. Likely to miss smaller/non-violent events but has a long time-frame/global coverage.</td>
</tr>
<tr class="even">
<td><a href="https://proxy-um.researchport.umd.edu/login?url=https://global.factiva.com/en/sess/login.asp">Factiva</a></td>
<td>Global archive of multiple news sources. Time period depends on the source. (anecdotally: coverage before 1980 is very sparse)</td>
<td>Very expansive collection, especially for recent news, but also it will contain a lot of duplicates because it has multiple sources.</td>
</tr>
<tr class="odd">
<td><a href="https://proxy-um.researchport.umd.edu/login?url=https://www.proquest.com/pubset/1">National Newspapers Core</a></td>
<td>Collection of news archives for major US publications such as the New York Times, Washington Post, LA Times etc. Some coverage back to the 1980s.</td>
<td>Significant overlap with Nexis Uni. Good source for U.S., but global coverage may be less reliable.</td>
</tr>
<tr class="even">
<td><a href="https://proxy-um.researchport.umd.edu/login?url=https://www.nexisuni.com">Nexis Uni</a></td>
<td>Collection of U.S. and global newspapers. Most sources go back to the 1980s/70s.</td>
<td>See above.</td>
</tr>
<tr class="odd">
<td><a href="https://lib.guides.umd.edu/az.php?s=66314">Other niche publications through UMD</a></td>
<td>Go to the database finder and select the “journalism” filter. There are a number of additional regional/ethnic/historic collections available.</td>
<td></td>
</tr>
<tr class="even">
<td>Historic coverage</td>
<td>Available for selected outlets (mostly US) but often separate from more recent coverage.</td>
<td><p>Examples:</p>
<p><a href="https://proxy-um.researchport.umd.edu/login?url=http://search.proquest.com/hnpnewyorktimeswindex?accountid=14696">New York Times 1851-2016</a><br>
<a href="https://proxy-um.researchport.umd.edu/login?url=https://search.proquest.com/hnpwashingtonpost/advanced?accountid=14696">Washington Post 1877-2003</a><br>
<a href="https://proxy-um.researchport.umd.edu/login?url=https://search.proquest.com/hnpbaltimoresun/advanced?accountid=14696">Baltimore Sun 1837-1994</a></p></td>
</tr>
</tbody>
</table>
<p>Each of these sources will have a slightly different user interface, but you’ll inevitably need to do a little prodding and poking to get useful information from them. The next section will walk through that process using Factiva as an example.</p>
</section>
<section id="finding-data-about-a-movement-tactic-or-group-in-factiva" class="level1 page-columns page-full">
<h1>Finding data about a movement, tactic, or group in Factiva</h1>
<p>Lets try getting data on the use of “glitter bombing” from Factiva using the search builder.</p>
<p><img src="images/factiva_step1.png" class="img-fluid" alt="Selecting the search tab from the banner on the Factiva landing page"></p>
<p>Factiva’s primary audience isn’t necessarily researchers, and their default search settings probably reflect that. Just searching for glitter bomb will bring up all results from the last three months from any English language source, and most of those will not be relevant.</p>
<p>To get better information, I’ll probably want to do stuff like:</p>
<ol type="1">
<li>Pick a defined time frame and/or a geographic scope</li>
<li>Modify my search terms to include or exclude irrelevant stories (as much as feasible)</li>
<li>Restrict my search to include specific news sources and/or subjects.</li>
</ol>
<p>I’ll start changing my date range. Anya Galli’s paper mentions that glitter bombing really took off in 2011. I’ll set 2010 as my start date just in case, and I’ll set my end date to 2024:</p>
<p><img src="images/factiva_step4.png" class="img-fluid"></p>
<p>Next, I’ll scroll down to the “Region” section and select the United States.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/factiva_select_region.png" class="img-fluid figure-img"></p>
<figcaption>Selecting a region</figcaption>
</figure>
</div>
</div></div><p>You’ll notice that when you hit the little blue arrow next to the country name, <code>re=usa</code> will be added to the query terms. That’s the query language to restrict results to a particular region. However, I’ll get an error message if I try to run this as-is. I’ll need to add the word AND between my terms and the region query to indicate that I want articles containing the terms “glitter bomb” AND that come from the US.</p>
<p>So my search query now looks like this:</p>
<p><code>glitter bomb AND re=usa</code></p>
<p>Next, I’ll want to limit the subjects. Factiva contains <em>A LOT</em> of stuff other than just news, so we’ll want to filter out most of this information and just get items in the “Political/General News” category. Once again, I’ll need to add the AND operator when I add this filter.</p>
<p><code>glitter bomb AND re=usa AND ns=gcat</code></p>
<p>Finally, it may be redundant, but I think it can be a good idea to filter the news sources to Major News and Business Sources -&gt; U.S. So that gives us:</p>
<p><code>glitter bomb AND re=usa AND ns=gcat AND rst=tmnbus</code></p>
<p>Finally, I might want to change my query language a little bit too. We’re primarily interested in the use of glitter bombs as a form of protest, but <a href="https://abc7news.com/bait-cars-glitter-bomb-backpack-mark-rober-youtube-san-francisco-car-break-in/14179723/">there’s plenty of other uses</a>. One simple method would be to just add terms like “protest” or “activists” to the search.</p>
<p>I’ll add a <code>*</code> wild card to the end of these terms so I can capture terms like “bombing” “protester” and “activists”, and I’ll add an OR statement between protests or activists to catch articles that use either term.</p>
<p>My final query looks like this:</p>
<p><code>(glitter bomb*) and (protest* OR activist*) AND re=usa AND ns=gcat AND rst=tmnbus</code></p>
<p>And returns about 41 results for the selected time period. While not all of these document a protest event (and many may document the same event more than once) its reasonably easy to filter out the wheat from the chaff. From here, I might want to start making a list of unique events, their targets and exact dates (which may not be the same as the publication date!) the number of participants and their organization affiliations etc.</p>
<p>Once I’m finished, it might be a good idea to export some or all of the articles for future use. I can export the text by selecting articles and then hitting the menu at the top of the search results:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/factiva_export_results.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>If you’re trying to get a lot of stuff: Factiva Places some restrictions on the number of articles you can export at a time (I think its 100) but you can get around this by just selecting articles in batches. They do strongly discourage “data mining”, but this is somewhat of a hazy line and its unlikely you’ll run afoul of these rules with normal usage.</p>
<p><a href="https://developer.dowjones.com/site/docs/getting_started/building_queries/legacy_search/index.gsp#">Additional information about the Factiva query language</a></p>
<section id="importing-factiva-articles-to-r" class="level2">
<h2 class="anchored" data-anchor-id="importing-factiva-articles-to-r">Importing Factiva Articles to R</h2>
<p>(This information isn’t really required for this course, but it came up last semester so I’m including it here.)</p>
<p>If you have a lot of articles (more than a couple hundred, at a minimum) and you want to use them for something like a large scale text analysis: Kohei Watanabe has created an R package you can use to import and format data from factiva or lexisnexis for this exact purpose. If this is something you’re interested in trying out, <a href="https://github.com/koheiw/newspapers">there’s good instructions for the import process on his github page</a>. Keep in mind you’ll need the articles in HTML format (<a href="https://github.com/koheiw/newspapers?tab=readme-ov-file#dow-jones-faciva">here’s instructions on how to get that</a>)</p>
<p>Here’s an example of using his code to import the text of those glitter bomb related Factiva articles:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run these two lines to install the package</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># once you've installed, you don't need to run them again!</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"devtools"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"koheiw/newspapers"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Import the data using the <code>import_factiva</code> function followed by the name of your files.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># then load the package and use import_factiva to save your html formatted results:</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(newspapers)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>glitter_stories<span class="ot">&lt;-</span> <span class="fu">import_factiva</span>(<span class="st">"Factiva_Glitter_Articles.html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading Factiva_Glitter_Articles.html </code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(glitter_stories<span class="sc">$</span>head)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Animal rights activist facing felony charges after throwing glitter on interim Harvard president"                      
[2] "A Black Institution's Bold Visionary"                                                                                  
[3] "There Are Lots of Outlets for Stress Relief"                                                                           
[4] "Photos: WorldPride Wraps Up with Parades and Parties"                                                                  
[5] "Dems keep close eye on Omar’s missteps // Additional controversies could lead to Democratic primary challenge in 2020."
[6] "Glitter Secrets"                                                                                                       </code></pre>
</div>
</div>
<p>Here’s an example of creating a basic plot showing the number of articles per year. (far from the most interesting thing we could do with the data!)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>story_counts <span class="ot">&lt;-</span> glitter_stories<span class="sc">|&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># re-format publication dates </span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pubdate =</span> <span class="fu">dmy</span>(date),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">pubyear =</span> <span class="fu">year</span>(pubdate)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>         )<span class="sc">|&gt;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(pubyear)<span class="sc">|&gt;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>())<span class="sc">|&gt;</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(pubyear)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>story_plot<span class="ot">&lt;-</span><span class="fu">ggplot</span>(story_counts, <span class="fu">aes</span>(<span class="at">x=</span>pubyear, <span class="at">y=</span> n)) <span class="sc">+</span> </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()  <span class="sc">+</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Number of stories in year"</span>) <span class="sc">+</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>story_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="event_data_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>